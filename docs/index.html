<html>
  <head>
  <link rel="stylesheet" href="https://naohirotamura.github.io/commit-count-report/assets/main.css">
  <!-- JS -->
  <script src="https://naohirotamura.github.io/commit-count-report/assets/vendor/jquery.min.js"></script>
  <script src="https://naohirotamura.github.io/commit-count-report/assets/vendor/popper.min.js"></script>
  <script src="https://naohirotamura.github.io/commit-count-report/assets/vendor/bootstrap.min.js"></script>
</head>

  <body>
    <div class="container-fluid">
      <h1 id="commit-count-report">Commit Count Report</h1>

<p>FaaS Shell sample <a href="https://github.com/NaohiroTamura/faasshell/blob/master/samples/demo_commit_count_report.md" title="Commit Count Report">Commit Count Report</a> Web GUI. <em>GET Commit Count</em> button privdes the same effect as the following git command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/NaohiroTamura/faasshell
<span class="nv">$ </span><span class="nb">cd </span>faasshell
<span class="nv">$ </span>git log <span class="nt">--since</span><span class="o">=</span>2018-06-21T00:00:00+00:00 <span class="nt">--until</span><span class="o">=</span>2018-07-20T00:00:00+00:00 <span class="nt">--no-merges</span> <span class="nt">--format</span><span class="o">=</span>%ae | <span class="nb">grep </span>fujitsu.com | wc <span class="nt">-l</span>
</code></pre></div></div>

<p>All results are logged into <a href="https://docs.google.com/spreadsheets/d/1ywCxG8xTKOYK89AEZIqgpTvbvpbrb1s4H_bMVvKV59I/edit#gid=0" title="Google Sheets" target="_blank">Google Sheets</a>.</p>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="jumbotron">

<label for="github-url">GitHub Repository URL</label>
<div class="input-group mb-3">
    <div class="input-group-prepend">
        <span class="input-group-text" id="basic-addon1">https://github.com/</span>
    </div>
        <input type="text" class="form-control" id="github-url" placeholder="naohirotamura/faasshell" aria-describedby="basic-addon1" />
    </div>

<label for="commiter-search">Commiter's search string</label>
<div class="input-group mb-3">
    <input type="text" class="form-control" id="commiter-search" placeholder="fujitsu.com" aria-label="fujitsu.com" />
</div>

<label for="basic-url">Search Duration (Option)</label>
<div class="input-group mb-3">
    <div class="input-group-prepend">
        <span class="input-group-text" id="basic-addon3">Since</span>
    </div>
    <input type="text" class="form-control" id="date-since" placeholder="2018-06-21T00:00:00+00:00" aria-label="Since" aria-describedby="basic-addon3" />
</div>

<div class="input-group mb-3">
    <div class="input-group-prepend">
        <span class="input-group-text" id="basic-addon4">Until</span>
    </div>
    <input type="text" class="form-control" id="date-until" placeholder="2018-07-20T00:00:00+00:00" aria-label="Until" aria-describedby="basic-addon4" />
</div>

<div class="input-group mb-3">
    <button id="mybutton" class="btn btn-primary btn-large">GET Commit Count</button>
</div>

<label for="search-result">Result</label>
<div class="input-group mb-3">
    <input type="text" class="form-control" id="search-result" />
</div>

            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function(){
    console.log("button action loading");
    console.log(`#commiter-search = ${$('#commiter-search').val()}`);
    console.log(`#github-url = ${$('#github-url').val()}`);
    console.log(`#date-since = ${$('#date-since').val()}`);
    console.log(`#date-until = ${$('#date-until').val()}`);
    $("#mybutton").click(function(){
        console.log("button clicked");
        $('#search-result').val("");
        console.log(`#commiter-search = ${$('#commiter-search').val()}`);
        console.log(`#github-url = ${$('#github-url').val()}`);
        let github = $('#github-url').val().split('/');
        console.log(`owner = ${github[0]}`);
        console.log(`name = ${github[1]}`);
        console.log(`#date-since = ${$('#date-since').val()}`);
        console.log(`#date-until = ${$('#date-until').val()}`);
        $.ajax({
            async: true,
            type: 'POST',
            url: 'https://protected-depths-49487.herokuapp.com/statemachine/commit_count_report.json?blocking=true',
            //url: 'http://127.0.0.1:8080/statemachine/commit_count_report.json?blocking=true',
            headers: {
                'Authorization': 'Basic ' + btoa('ec29e90c-188d-11e8-bb72-00163ec1cd01:0b82fe63b6bd450519ade02c3cb8f77ee581f25a810db28f3910e6cdd9d041bf')
            },
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({
                input: {
                    github: {
                        target: $('#commiter-search').val(),       // 'fujitsu.com',
                        owner:  github[0],                        // 'naohirotamura',
                        name:   github[1],                        // 'faasshell',
                        since:  $('#date-since').val(),           // '2018-06-21T00:00:00+00:00',
                        until:  $('#date-until').val(),           // '2018-07-20T00:00:00+00:00'
                    },
                    gsheet: {
                        sheetId: '1ywCxG8xTKOYK89AEZIqgpTvbvpbrb1s4H_bMVvKV59I'
                    }
                }
            }),
            dataType: 'json', // PreFlight
        }).done(function(data, status){
            console.log("Data: " + JSON.stringify(data) + "\nStatus: " + status);
            $('#search-result').val(data.output.github.output.values[0][5]);
            console.log("Result: " + data.output.github.output.values[0][5] + "\n");
        }).fail(function(xhr, status, error){
            console.log("Failed: " + error + "\nStatus: " + status);
            $('#search-result').val(status);
        });
        console.log("button action done");
    });
});
</script>


    </div>
    
  </body>
</html>
